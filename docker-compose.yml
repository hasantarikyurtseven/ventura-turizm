services:
  # Infrastructure
  mongo:
    image: mongo:latest
    container_name: ventura-mongo
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: example
    volumes:
      - mongo-data:/data/db

  redis:
    image: redis:alpine
    container_name: ventura-redis
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data

  minio:
    image: minio/minio:latest
    container_name: ventura-minio
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    command: server /data --console-address ":9001"
    volumes:
      - minio-data:/data

  # Backend Apps
  admin-api:
    build:
      context: ./apps/admin-api
      dockerfile: Dockerfile.dev
    container_name: ventura-admin-api
    ports:
      - "${ADMIN_API_PORT:-3001}:3000"
    environment:
      - MONGO_URI=${MONGO_URI}
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - CHOKIDAR_USEPOLLING=true
    volumes:
      - ./apps/admin-api:/app
      - /app/node_modules
    depends_on:
      - mongo
      - redis

  client-api:
    build:
      context: ./apps/client-api
      dockerfile: Dockerfile.dev
    container_name: ventura-client-api
    ports:
      - "${CLIENT_API_PORT:-3002}:3000"
    environment:
      - MONGO_URI=${MONGO_URI}
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - CHOKIDAR_USEPOLLING=true
    volumes:
      - ./apps/client-api:/app
      - /app/node_modules
    depends_on:
      - mongo
      - redis

  jobs-service:
    build:
      context: ./apps/jobs-service
      dockerfile: Dockerfile.dev
    container_name: ventura-jobs-service
    environment:
      - MONGO_URI=${MONGO_URI}
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - CHOKIDAR_USEPOLLING=true
    volumes:
      - ./apps/jobs-service:/app
      - /app/node_modules
    depends_on:
      - mongo
      - redis

  # Frontend Apps
  admin-dashboard:
    build:
      context: ./apps/admin-dashboard
      dockerfile: Dockerfile.dev
    container_name: ventura-admin-dashboard
    ports:
      - "${ADMIN_DASHBOARD_PORT:-4200}:4200"
    volumes:
      - ./apps/admin-dashboard:/app
      - /app/node_modules
    environment:
      - WATCHPACK_POLLING=true

  client-web:
    build:
      context: ./apps/client-web
      dockerfile: Dockerfile.dev
    container_name: ventura-client-web
    ports:
      - "${CLIENT_WEB_PORT:-4300}:4300"
    volumes:
      - ./apps/client-web:/app
      - /app/node_modules
    environment:
      - WATCHPACK_POLLING=true

volumes:
  mongo-data:
  redis-data:
  minio-data:
